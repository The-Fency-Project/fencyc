- move halt to main end
- change reg alloc
- make codegen see vars in regs
